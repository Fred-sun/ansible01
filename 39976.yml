- azure_rm_networkinterface:
    resource_group: "{{ specified_resourcegroup.name }}"
    name: "{{ project }}_{{ application }}_external"
    virtual_network: "{{ virtualnetwork_by_name.ansible_facts.azure_virtualnetworks.0.name }}"
    subnet_name: '{{ internal_public_subnet_result.name }}'
    security_group_name: "{{ project }}_ssh_public_external"
    ip_configurations:
      - name: ipconfig1
        public_ip_address_name: "{{ project }}_{{ application }}_external_ip"
        primary: yes
        
-  azure_rm_networkinterface:
    resource_group: "{{ specified_resourcegroup.name }}"
    name: "{{ project }}_{{ application }}_internal"    
    virtual_network: "{{ virtualnetwork_by_name.ansible_facts.azure_virtualnetworks.0.name }}"
    subnet_name: "{{ internal_private_subnet_result.name }}"
    security_group_name: "{{ project }}_closed"
    ip_configurations:
      - name: ipconfig1
        primary: no

- azure_rm_virtualmachine:
    resource_group: "{{ specified_resourcegroup.name }}"
    location: "{{ region }}"
    name: "{{ project }}-{{ application }}"
    network_interface_names: 
      - "{{ project }}_{{ application }}_external"
      - "{{ project }}_{{ application }}_internal" 
    vm_size: "{{ type }}"
    admin_username: "{{ user }}"
    ssh_password_enabled: False
    ssh_public_keys:
      - path: "/home/{{ user }}/.ssh/authorized_keys"
        key_data: "{{ key_contents }}"
    image:
      publisher: OpenLogic
      offer: CentOS
      sku: '7.4'
      version: latest


